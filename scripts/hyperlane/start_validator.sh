#!/bin/bash

VALIDATOR_SIG_DIR="validator-sig"
VALIDATOR_PK="0x0f95f8340bcb02cd650fd730bfde4933d0b0d2bb8816c61c6fc974fb277b57fb"
MERKLE_TREE_HOOK_ID="0x726f757465725f706f73745f6469737061746368000000030000000000000001"
MAILBOX_ID="0x68797065726c616e650000000000000000000000000000000000000000000000"
IGP_ID="0x726f757465725f706f73745f6469737061746368000000040000000000000000"

mkdir -p "./$VALIDATOR_SIG_DIR"

docker run --rm \
  --platform=linux/amd64 \
  -e HYP_DB=/tmp/validator-db \
  -e HYP_LOG_LEVEL=debug \
	-e HYP_INTERVAL=3 \
	-e HYP_VALIDATOR_TYPE=hexKey \
	-e HYP_VALIDATOR_KEY=$VALIDATOR_PK \
	-e HYP_VALIDATOR_ACCOUNTADDRESSTYPE=Ethereum \
	-e HYP_CHECKPOINTSYNCER_TYPE=localStorage \
	-e HYP_CHECKPOINTSYNCER_PATH=$VALIDATOR_SIG_DIR \
	-e HYP_ORIGINCHAINNAME=injectivez \
	-e HYP_CHAINS_INJECTIVEZ_INDEX_CHUNK=20 \
	-e HYP_CHAINS_INJECTIVEZ_NAME=injectivez \
	-e HYP_CHAINS_INJECTIVEZ_SIGNER_TYPE=cosmosKey \
	-e HYP_CHAINS_INJECTIVEZ_SIGNER_PREFIX=inj \
	-e HYP_CHAINS_INJECTIVEZ_SIGNER_KEY=$VALIDATOR_PK \
	-e HYP_CHAINS_INJECTIVEZ_SIGNER_ACCOUNTADDRESSTYPE=Ethereum \
	-e HYP_CHAINS_INJECTIVEZ_CONTRACTADDRESSBYTES=20 \
	-e HYP_CHAINS_INJECTIVEZ_GASPRICE_AMOUNT=160000000 \
	-e HYP_CHAINS_INJECTIVEZ_GASPRICE_DENOM=inj \
	-e HYP_CHAINS_INJECTIVEZ_NATIVETOKEN_DECIMALS=18 \
	-e HYP_CHAINS_INJECTIVEZ_NATIVETOKEN_DENOM=inj \
	-e HYP_CHAINS_INJECTIVEZ_MERKLETREEHOOK=$MERKLE_TREE_HOOK_ID \
	-e HYP_CHAINS_INJECTIVEZ_BECH32PREFIX=inj \
	-e HYP_CHAINS_INJECTIVEZ_CANONICALASSET=inj \
	-e HYP_CHAINS_INJECTIVEZ_VALIDATORANNOUNCE=$MAILBOX_ID \
	-e HYP_CHAINS_INJECTIVEZ_CHAINID=injective-1 \
	-e HYP_CHAINS_INJECTIVEZ_DOMAINID=1212 \
	-e HYP_CHAINS_INJECTIVEZ_MAILBOX=$MAILBOX_ID \
	-e HYP_CHAINS_INJECTIVEZ_INTERCHAINGASPAYMASTER=$IGP_ID \
	-e HYP_CHAINS_INJECTIVEZ_PROTOCOL=cosmosNative \
  -e HYP_CHAINS_INJECTIVEZ_RPCURLS_0_HTTP=http://host.docker.internal:26657 \
  -e HYP_CHAINS_INJECTIVEZ_GRPCURLS_0_HTTP=http://host.docker.internal:9900 \
  -v $(pwd)/$VALIDATOR_SIG_DIR:/validator-sig \
  public.ecr.aws/l9h3g6c6/injective-hyperlane-agents:v1.16.0-inj \
  bash -c "mkdir -p /tmp/validator-db && ./validator"

